# .github/workflows/build.yml
name: Build Test (Sem Secrets)

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main

jobs:
  build-test:
    runs-on: ubuntu-latest
    # SEM permiss√£o de write - n√£o pode commitar
    permissions:
      contents: read  # Apenas leitura

    steps:
      - uses: actions/checkout@v4
      
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'gradle'

      - name: Grant execute permission
        run: chmod +x gradlew

      # N√ÉO injeta secrets - usa placeholder ou chave de teste
      - name: Setup Test Environment
        run: |
          echo "Usando ambiente de TESTE (sem chaves reais)"
          
          # Cria chave de teste/fake para compila√ß√£o
          TEST_KEY="TMDB_TEST_KEY_PLACEHOLDER_123"
          
          # Substitui placeholder por chave de TESTE
          find . -name "*.kt" -type f -exec sed -i \
            "s/{{TMDB_API_KEY}}/$TEST_KEY/g" {} +
          
          echo "‚úÖ Ambiente de teste configurado"

      - name: Test Build (Verifica apenas se compila)
        run: ./gradlew assembleDebug --info
        # Usa 'assembleDebug' em vez de 'assemble' para ser mais r√°pido

      - name: Verify Build Output
        run: |
          echo "üìã Verificando sa√≠da do build:"
          find . -name "*.apk" -o -name "*.cs3" | head -5 || echo "‚ö†Ô∏è Nenhum arquivo gerado (normal para build de teste)"
          
      # üö´ N√ÉO faz deploy - apenas verifica se compila
